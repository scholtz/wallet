import{d as de,u as le,g as ie,a as ce,h as re,r as pe,F as B,w as ue,o as me,i as I,c as _e,b as S,j as u,k as s,l as r,t as n,e as a,q as V,m as M,f as R,y as v,n as g,s as fe,M as he,v as x,A as F,z as k,C as E,D as ge,x as ye}from"./index-Bjo5_Pb3.js";import{C as W,g as z,b as O,p as Ae,B as j,d as we,c as be}from"./index-CipLxXWk.js";const Ie={class:"field grid"},ve={class:"col-12 mb-2 md:col-2 md:mb-0"},xe={class:"col-12 md:col-10"},Te={class:"field grid"},De={class:"col-12 mb-2 md:col-2 md:mb-0"},Se={class:"col-12 md:col-10"},ke={class:"field grid"},Ne={class:"col-12 mb-2 md:col-2 md:mb-0"},Ce={class:"col-12 md:col-10"},Be={class:"field grid"},Ve={class:"col-12 mb-2 md:col-2 md:mb-0"},Me={class:"col-12 md:col-10"},Re={class:"field grid"},Fe={class:"col-12 mb-2 md:col-2 md:mb-0"},Pe={class:"col-12 md:col-10"},Ge={class:"field grid"},Ue={class:"col-12 mb-2 md:col-2 md:mb-0"},$e={class:"col-12 md:col-10"},Ee={class:"field grid"},We={for:"amountToDeposit",class:"col-12 mb-2 md:col-2 md:mb-0"},ze={class:"col-12 md:col-10"},Oe={class:"field grid"},je={for:"amountToDeposit",class:"col-12 mb-2 md:col-2 md:mb-0"},He={class:"col-12 md:col-10"},qe={class:"field grid"},Je={class:"col-12 md:col-10"},Le={key:0,class:"grid"},Qe={class:"col"},Ze={class:"p-input-icon-left"},Ke={key:0},Xe={class:"field grid"},Ye={for:"optin",class:"col-12 mb-2 md:col-2 md:mb-0"},et={class:"col-12 md:col-10"},tt={class:"field grid"},st={for:"withdrawAsset",class:"col-12 mb-2 md:col-2 md:mb-0"},at={class:"col-12 md:col-10"},ot={class:"field grid"},nt={for:"withdrawAmount",class:"col-12 mb-2 md:col-2 md:mb-0"},dt={class:"col-12 md:col-10"},lt={class:"field grid"},it={class:"col-12 md:col-10"},ct={class:"field grid"},rt={key:0,class:"field grid"},_t=de({__name:"ScheduledPaymentDetail",setup(pt){const N=o=>{if(!o)return[];const t=o,c=t["global-state"]??t.globalState;return Array.isArray(c)?c:[]},H=o=>o?o.map(t=>({assetId:BigInt(t.assetId??t.assetId??0n),amount:Number(t.amount??0)})):[],{t:l}=le(),A=ie(),i=ce(),T=re(),e=pe({selection:null,payTo:"",assetData:new W,account:A.params.account,withdrawAmount:0,maxAmount:0,stepAmount:1,appInfo:{appId:0,appAddress:"",start:0,period:0,balanceFee:0,fee:0},assets:[],filters:{global:{value:null,matchMode:B.CONTAINS},assetName:{value:null,matchMode:B.STARTS_WITH},amount:{value:null,matchMode:B.STARTS_WITH}},period:"86400",optionsSchedule:[{value:"60",name:"Run each minute"},{value:"3600",name:"Run each hour"},{value:"86400",name:"Run each day"}],start:Math.round(new Date().getTime()/1e3),txID:"",action:"",hash:"",client:"",appId:"",fee:1e3,feeAssetId:0,feeAssetData:{},optin:0,withdrawAsset:null,amountToDeposit:0,script:""}),q=()=>i.state.wallet.privateAccounts.find(t=>t.addr===e.account)?.data?.[i.state.config.env],J=()=>{if(!e.assetData)return 0;if(e.assetData.type=="ARC200"||e.assetData.type=="ASA"){const p=e.assetData.decimals??0;return Number(e.assetData.amount||0)/10**p}const o=q();if(!o?.amount)return 0;let t=o.amount/1e6-.1;const c=o.assets?.length??0;return c>0&&(t-=c*.1),Math.max(t,0)},L=()=>e.assetData.decimals?Math.pow(10,-1*e.assetData.decimals):1;ue(()=>e.assetData,async()=>{e.maxAmount=J(),e.stepAmount=L(),await i.dispatch("wallet/prolong")},{deep:!0});const Q=async()=>{try{const o=await i.dispatch("algod/getAlgod"),t=await i.dispatch("indexer/getIndexer"),c=z(i.state.config.env),p=await o.getApplicationByID(c).do(),f=N(p.params).find(b=>b.key=="ZmE=")?.value.uint??0;e.feeAssetId=f;const h=await i.dispatch("indexer/getAsset",{assetIndex:f});h&&(e.feeAssetData=h);const _=Number(A.params.appId);e.appId=_.toString();const y=await o.getApplicationBoxByName(c,O(c,_).name).do(),d=Ae(y.value),w=await o.getApplicationByID(_).do(),D=N(w.params),ae=D.find(b=>b.key=="cw==")?.value.uint??0,oe=D.find(b=>b.key=="cA==")?.value.uint??0;e.appInfo={appId:_,appAddress:String(x.getApplicationAddress(_)),start:ae,period:oe,balanceFee:d.funds,fee:d.fee};const P=await t.lookupAccountByID(x.getApplicationAddress(_)).do(),C=[],G=await i.dispatch("indexer/getAsset",{assetIndex:0});C.push({assetId:0n,amount:Number(P?.account?.amount??0),assetName:G?.name??"",info:G});const ne=H(P?.account?.assets);for(const b of ne){const U=b.assetId??0n,$=await i.dispatch("indexer/getAsset",{assetIndex:U});C.push({assetId:U,amount:Number(b.amount??0),assetName:$?.name??"",info:$})}e.assets=C}catch(o){console.error(o)}};me(async()=>{await i.dispatch("wallet/prolong"),await Q();try{const t=JSON.parse(localStorage.getItem("currentAction")??"");if(t.selection&&(e.selection=t.selection),t.payTo&&(e.payTo=t.payTo),t.assetData){var o=new W;o.amount=t.assetData.amount,o.assetId=t.assetData.assetId,o.decimals=t.assetData.decimals,o.label=t.assetData.label,o.name=t.assetData.name,o.type=t.assetData.type,o.unitName=t.assetData.unitName,e.assetData=o}}catch(t){console.error(t.message??t)}});const Z=async()=>{try{const t=await i.dispatch("algod/getAlgod"),c={addr:A.params.account,signer:async(w,D)=>[]};var o=new j({resolveBy:"id",id:e.appInfo.appId},t);const p=new F;await o.assetTransfer({assetAmount:0,assetReceiver:e.appInfo.appAddress,note:"",xferAsset:e.optin},{sendParams:{fee:k(2e3),atc:p},assets:[e.optin]});const m=await t.getTransactionParams().do(),f=e.appInfo.appAddress,h=x.makePaymentTxnWithSuggestedParamsFromObject({amount:1e5,suggestedParams:m,receiver:f,sender:c.addr.toString()}),_=p.buildGroup().map(w=>w.txn),y=[h,_[0]],d=x.assignGroupID(y);await i.dispatch("signer/returnToSignAll","ScheduledPayments"),await i.dispatch("signer/toSignArray",{txs:d}),await T.push("/signAll")}catch(t){console.error(t)}},K=async()=>{try{const t=await i.dispatch("algod/getAlgod"),c={addr:A.params.account,signer:async(w,D)=>[]},p=z(i.state.config.env);var o=new we({resolveBy:"id",id:p,sender:c},t);const m=await t.getTransactionParams().do(),f=e.feeAssetData.decimals??0,h=x.makeAssetTransferTxnWithSuggestedParamsFromObject({amount:e.amountToDeposit*10**f,assetIndex:e.feeAssetId,sender:c.addr.toString(),suggestedParams:m,receiver:x.getApplicationAddress(p)}),_=O(p,e.appInfo.appId),y=new F;await o.fundTask({deposit:h,taskAppId:e.appInfo.appId},{sendParams:{fee:k(1e3),atc:y},boxes:[_]});const d=y.buildGroup().map(w=>w.txn);await i.dispatch("signer/returnToSignAll","ScheduledPayments"),await i.dispatch("signer/toSignArray",{txs:d}),await T.push("/signAll")}catch(t){console.error(t)}},X=async()=>{try{const t=await i.dispatch("algod/getAlgod"),c={addr:A.params.account,signer:async(_,y)=>[]};var o=new j({resolveBy:"id",id:e.appInfo.appId,sender:c},t);const p=new F,m=Number(e.withdrawAsset);if(m>0){const _=await i.dispatch("indexer/getAsset",{assetIndex:m});await o.assetTransfer({assetAmount:Number(e.withdrawAmount)*10**(_?.decimals??6),assetReceiver:c.addr,note:"",xferAsset:m},{sendParams:{fee:k(2e3),atc:p},assets:[m]})}else await o.payment({amount:Number(e.withdrawAmount)*10**6,receiver:c.addr,note:""},{sendParams:{fee:k(2e3),atc:p}});const f=p.buildGroup().map(_=>_.txn);await i.dispatch("signer/returnTo","ScheduledPayments"),await i.dispatch("signer/toSign",{txx:f[0]});const h=be(E.from(x.encodeUnsignedTransaction(f[0])).toString("base64"));e.txID=f[0].txID(),T.push(`/sign/${A.params.account}/${h}`)}catch(t){console.error(t)}},Y=o=>{T.push({name:"PayToAccountAndAsset",params:{account:A.params.account,toAccountDirect:e.appInfo.appAddress,asset:o.assetId}})};async function ee(o){ge(String(o))&&await i.dispatch("toast/openSuccess",`${o} copied to clipboard`)}const te=()=>{T.push({name:"SwapWithTo",params:{account:A.params.account,toAsset:e.feeAssetId}})},se=async()=>{try{const t=await(await i.dispatch("algod/getAlgod")).getApplicationByID(e.appInfo.appId).do(),p=N(t.params).find(h=>h.key=="aWQ=")?.value.bytes;if(!p)throw new Error("Script identifier not found in global state");const m=E.from(p,"base64").subarray(2).toString("utf-8"),f=await ye.get(`https://api-scheduler.biatec.io/v1/file/${m}/input.yaml`);e.script=f.data}catch(o){console.error(o)}};return(o,t)=>{const c=I("InputNumber"),p=I("InputText"),m=I("Column"),f=I("DataTable"),h=I("InputGroup"),_=I("Textarea"),y=I("Card");return S(),_e(he,null,{default:u(()=>[s("h1",null,n(a(l)("scheduled_payments.title")),1),r(y,null,{content:u(()=>[s("p",null,n(a(l)("scheduled_payments.description_detail")),1),s("h2",null,n(a(l)("scheduled_payments.details_title")),1),s("div",Ie,[s("label",ve,n(a(l)("scheduled_payments.app_id")),1),s("div",xe,n(e.appInfo.appId),1)]),s("div",Te,[s("label",De,n(a(l)("scheduled_payments.appAddress")),1),s("div",Se,n(e.appInfo.appAddress),1)]),s("div",ke,[s("label",Ne,n(a(l)("scheduled_payments.period")),1),s("div",Ce,n(e.appInfo.period)+" "+n(a(l)("scheduled_payments.seconds")),1)]),s("div",Be,[s("label",Ve,n(a(l)("scheduled_payments.start")),1),s("div",Me,n(new Date(e.appInfo.start*1e3)),1)]),s("div",Re,[s("label",Fe,n(a(l)("scheduled_payments.feeBalance")),1),s("div",Pe,n(a(R)(e.appInfo.balanceFee,e.feeAssetData.unitName??e.feeAssetData.name,e.feeAssetData.decimals??0)),1)]),s("div",Ge,[s("label",Ue,n(a(l)("scheduled_payments.execution_fee")),1),s("div",$e,n(a(R)(e.appInfo.fee,e.feeAssetData.unitName??e.feeAssetData.name,e.feeAssetData.decimals??0)),1)]),s("h2",null,n(a(l)("scheduled_payments.deposit_fee_title")),1),s("div",Ee,[s("label",We,n(a(l)("scheduled_payments.fee_asset_id")),1),s("div",ze,[r(a(v),{size:"small",link:"",onClick:t[0]||(t[0]=d=>ee(e.feeAssetId))},{default:u(()=>[g(n(e.feeAssetId),1)]),_:1}),r(a(v),{severity:"secondary",size:"small",onClick:te},{default:u(()=>[g(n(a(l)("scheduled_payments.get_more")),1)]),_:1})])]),s("div",Oe,[s("label",je,n(a(l)("scheduled_payments.amount_to_deposit")),1),s("div",He,[r(c,{itemId:"amountToDeposit",modelValue:e.amountToDeposit,"onUpdate:modelValue":t[1]||(t[1]=d=>e.amountToDeposit=d),min:0,step:1e-6,maxFractionDigits:6,class:"w-full"},null,8,["modelValue"])])]),s("div",qe,[t[9]||(t[9]=s("label",{class:"col-12 mb-2 md:col-2 md:mb-0"},null,-1)),s("div",Je,[r(a(v),{severity:"primary",onClick:K},{default:u(()=>[g(n(a(l)("scheduled_payments.deposit")),1)]),_:1})])]),s("h2",null,n(a(l)("scheduled_payments.list_of_assets")),1),r(f,{selection:e.selection,"onUpdate:selection":t[3]||(t[3]=d=>e.selection=d),value:e.assets,"responsive-layout":"scroll","selection-mode":"single",paginator:!0,rows:20,filters:e.filters,"onUpdate:filters":t[4]||(t[4]=d=>e.filters=d),filterDisplay:"menu",globalFilterFields:["assetId","assetName"]},{header:u(()=>[e.filters.global?(S(),V("div",Le,[s("div",Qe,[s("span",Ze,[t[10]||(t[10]=s("i",{class:"pi pi-search"},null,-1)),r(p,{modelValue:e.filters.global.value,"onUpdate:modelValue":t[2]||(t[2]=d=>e.filters.global.value=d),placeholder:a(l)("placeholders.keyword_search")},null,8,["modelValue","placeholder"])])])])):M("",!0)]),empty:u(()=>[g(n(a(l)("scheduled_payments.assets_loading")),1)]),default:u(()=>[r(m,{field:"assetName",header:a(l)("scheduled_payments.asset_id"),sortable:!0},null,8,["header"]),r(m,{header:a(l)("scheduled_payments.asset_id"),sortable:!0},{body:u(d=>[g(n(d.data.assetId),1)]),_:1},8,["header"]),r(m,{header:a(l)("scheduled_payments.asset_name"),sortable:!0},{body:u(d=>[g(n(d.data.info.name),1)]),_:1},8,["header"]),r(m,{field:"amount",header:a(l)("scheduled_payments.asset_amount"),sortable:!0},{body:u(d=>[d.data.amount&&d.data.info?(S(),V("span",Ke,n(a(R)(d.data.amount,d.data.info["unit-name"]??d.data.info.name,d.data.info.decimals)),1)):M("",!0)]),_:1},8,["header"]),r(m,{header:a(l)("scheduled_payments.actions"),sortable:!0},{body:u(d=>[r(a(v),{onClick:w=>Y(d.data)},{default:u(()=>[g(n(a(l)("scheduled_payments.deposit")),1)]),_:1},8,["onClick"])]),_:1},8,["header"])]),_:1},8,["selection","value","filters"]),s("h2",null,n(a(l)("scheduled_payments.optin_title")),1),s("div",Xe,[s("label",Ye,n(a(l)("scheduled_payments.optin_to_asset")),1),s("div",et,[r(h,null,{default:u(()=>[r(c,{itemId:"optin",modelValue:e.optin,"onUpdate:modelValue":t[5]||(t[5]=d=>e.optin=d),min:0,step:1,class:"w-full"},null,8,["modelValue"]),r(a(v),{severity:"secondary",class:"col-2",onClick:Z},{default:u(()=>[g(n(a(l)("scheduled_payments.optin_click")),1)]),_:1})]),_:1})])]),s("h2",null,n(a(l)("scheduled_payments.withdraw_asset_title")),1),s("div",tt,[s("label",st,n(a(l)("scheduled_payments.withdraw_asset")),1),s("div",at,[r(a(fe),{inputId:"withdrawAsset",options:e.assets,modelValue:e.withdrawAsset,"onUpdate:modelValue":t[6]||(t[6]=d=>e.withdrawAsset=d),optionLabel:"assetName",optionValue:"assetId",class:"w-full"},null,8,["options","modelValue"])])]),s("div",ot,[s("label",nt,n(a(l)("scheduled_payments.withdraw_amount")),1),s("div",dt,[r(h,null,{default:u(()=>[r(c,{itemId:"withdrawAmount",modelValue:e.withdrawAmount,"onUpdate:modelValue":t[7]||(t[7]=d=>e.withdrawAmount=d),min:0,step:1e-6,maxFractionDigits:6,class:"w-full"},null,8,["modelValue"])]),_:1})])]),s("div",lt,[t[11]||(t[11]=s("label",{class:"col-12 mb-2 md:col-2 md:mb-0"},null,-1)),s("div",it,[r(a(v),{severity:"secondary",onClick:X},{default:u(()=>[g(n(a(l)("scheduled_payments.withdraw_click")),1)]),_:1})])]),s("h2",null,n(a(l)("scheduled_payments.load_script_title")),1),s("div",ct,[r(a(v),{severity:"secondary",onClick:se},{default:u(()=>[g(n(a(l)("scheduled_payments.load_click")),1)]),_:1})]),e.script?(S(),V("div",rt,[r(_,{id:"script",modelValue:e.script,"onUpdate:modelValue":t[8]||(t[8]=d=>e.script=d),class:"w-full",rows:"20"},null,8,["modelValue"])])):M("",!0)]),_:1})]),_:1})}}});export{_t as default};
