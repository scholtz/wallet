"use strict";(self["webpackChunkwallet"]=self["webpackChunkwallet"]||[]).push([[278],{76278:function(e,a,s){s.r(a),s.d(a,{default:function(){return me}});s(44114),s(18111),s(20116),s(61701);var t=s(20641),l=s(90033),d=s(50953),n=s(57057),o=s(66278),i=s(67422),c=s(76159),r=s(29193),p=s(37855),m=s(59049),u=s(75220),f=s(40763),h=s(71729),_=s(17965),A=s.n(_),y=s(38880),g=s(14038),v=s(94335);const b={class:"field grid"},w={class:"col-12 mb-2 md:col-2 md:mb-0"},k={class:"col-12 md:col-10"},I={class:"field grid"},D={class:"col-12 mb-2 md:col-2 md:mb-0"},L={class:"col-12 md:col-10"},$={class:"field grid"},x={class:"col-12 mb-2 md:col-2 md:mb-0"},F={class:"col-12 md:col-10"},T={class:"field grid"},S={class:"col-12 mb-2 md:col-2 md:mb-0"},R={class:"col-12 md:col-10"},V={class:"field grid"},P={class:"col-12 mb-2 md:col-2 md:mb-0"},C={class:"col-12 md:col-10"},N={class:"field grid"},W={class:"col-12 mb-2 md:col-2 md:mb-0"},B={class:"col-12 md:col-10"},U={class:"field grid"},X={for:"amountToDeposit",class:"col-12 mb-2 md:col-2 md:mb-0"},G={class:"col-12 md:col-10"},j={class:"field grid"},E={for:"amountToDeposit",class:"col-12 mb-2 md:col-2 md:mb-0"},H={class:"col-12 md:col-10"},M={class:"field grid"},O={class:"col-12 md:col-10"},Q={key:0,class:"grid"},z={class:"col"},q={class:"p-input-icon-left"},J={key:0},K={class:"field grid"},Z={for:"optin",class:"col-12 mb-2 md:col-2 md:mb-0"},Y={class:"col-12 md:col-10"},ee={class:"field grid"},ae={for:"withdrawAsset",class:"col-12 mb-2 md:col-2 md:mb-0"},se={class:"col-12 md:col-10"},te={class:"field grid"},le={for:"withdrawAmount",class:"col-12 mb-2 md:col-2 md:mb-0"},de={class:"col-12 md:col-10"},ne={class:"field grid"},oe={class:"col-12 md:col-10"},ie={class:"field grid"},ce={key:0,class:"field grid"};var re=(0,t.pM)({__name:"ScheduledPaymentDetail",setup(e){const a=(0,u.lq)(),s=(0,o.Pj)(),_=(0,u.rd)(),re=(0,d.Kh)({selection:"",payTo:"",assetData:new p.A,account:a.params.account,withdrawAmount:0,maxAmount:0,stepAmount:1,appInfo:{appId:0,appAddress:"",start:0,period:0,balanceFee:0,fee:0},assets:[],filters:{global:{value:null,matchMode:i.Rn.CONTAINS}},period:"86400",optionsSchedule:[{value:"60",name:"Run each minute"},{value:"3600",name:"Run each hour"},{value:"86400",name:"Run each day"}],start:Math.round((new Date).getTime()/1e3),txID:"",action:"",hash:"",client:"",appId:"",fee:1e3,feeAssetId:0,feeAssetData:new p.A,optin:0,withdrawAsset:"",amountToDeposit:0,script:""}),pe=()=>{const e=s.state.wallet.privateAccounts.find(e=>e.addr==re.account);return!!e&&(!!e.data&&e.data[s.state.config.env])},me=()=>{const e=pe();if(!re.assetData)return 0;if("ARC200"==re.assetData.type)return re.assetData?re.assetData.amount/10**re.assetData.decimals:0;if("ASA"==re.assetData.type)return re.assetData?re.assetData.amount/10**re.assetData.decimals:0;{let a=e.amount/1e6-.1;return e["assets"]&&e["assets"].length>0&&(a-=.1*e["assets"].length),a}},ue=()=>{if(!re.assetData.decimals)return 1;const e=Math.pow(10,-1*re.assetData.decimals);return e};(0,t.wB)(()=>re.assetData,async()=>{re.maxAmount=me(),re.stepAmount=ue(),await s.dispatch("wallet/prolong")},{deep:!0});const fe=async()=>{try{const e=await s.dispatch("algod/getAlgod"),t=await s.dispatch("indexer/getIndexer"),l=(0,y.RF)(s.state.config.env),d=await e.getApplicationByID(l).do(),n=d.params["global-state"].find(e=>"ZmE="==e.key).value.uint;re.feeAssetId=n,re.feeAssetData=await s.dispatch("indexer/getAsset",{assetIndex:n});const o=a.params.account,i=(g.Ay.decodeAddress(o),Number(a.params.appId));re.appId=i.toString();const c=await e.getApplicationBoxByName(l,(0,y.k$)(l,i).name).do(),r=(0,y.j5)(c.value),p=await e.getApplicationByID(i).do(),m=p.params["global-state"].find(e=>"cw=="==e.key).value.uint,u=p.params["global-state"].find(e=>"cA=="==e.key).value.uint;re.appInfo={appId:i,appAddress:g.Ay.getApplicationAddress(i),start:m,period:u,balanceFee:r.funds,fee:r.fee};const f=await t.lookupAccountByID(g.Ay.getApplicationAddress(i)).do(),h=[];let _=await s.dispatch("indexer/getAsset",{assetIndex:0});if(h.push({"asset-id":0,amount:f.account.amount,assetName:_.name,info:_}),f.account.assets)for(const a of f.account.assets){const e=await s.dispatch("indexer/getAsset",{assetIndex:a["asset-id"]});h.push({"asset-id":a["asset-id"],amount:a.amount,assetName:e.name,info:e})}re.assets=h}catch(e){console.error(e)}};(0,t.sV)(async()=>{await s.dispatch("wallet/prolong"),await fe();try{const a=JSON.parse(localStorage.getItem("currentAction")??"");if(a.selection&&(re.selection=a.selection),a.payTo&&(re.payTo=a.payTo),a.assetData){var e=new p.A;e.amount=a.assetData.amount,e["asset-id"]=a.assetData["asset-id"],e.decimals=a.assetData.decimals,e.label=a.assetData.label,e.name=a.assetData.name,e.type=a.assetData.type,e["unit-name"]=a.assetData["unit-name"],re.assetData=e}}catch(a){console.error(a.message??a)}});const he=async()=>{try{const t=await s.dispatch("algod/getAlgod"),l={addr:a.params.account,signer:async(e,a)=>[]};var e=new y.Ld({resolveBy:"id",id:re.appInfo.appId,sender:l},t);const d=new g.aX;await e.assetTransfer({assetAmount:0,assetReceiver:re.appInfo.appAddress,note:"",xferAsset:re.optin},{sendParams:{fee:h.Hv(2e3),atc:d},assets:[re.optin]});const n=await t.getTransactionParams().do(),o=g.Ay.makePaymentTxnWithSuggestedParamsFromObject({amount:1e5,from:l.addr,suggestedParams:n,to:re.appInfo.appAddress}),i=d.buildGroup().map(e=>e.txn),c=[o,i[0]],r=g.Ay.assignGroupID(c);await s.dispatch("signer/returnToSignAll","ScheduledPayments"),await s.dispatch("signer/toSignArray",{txs:r}),await _.push("/signAll")}catch(t){console.error(t)}},_e=async()=>{try{const t=await s.dispatch("algod/getAlgod"),l={addr:a.params.account,signer:async(e,a)=>[]},d=(0,y.RF)(s.state.config.env);var e=new y.s7({resolveBy:"id",id:d,sender:l},t);const n=await t.getTransactionParams().do(),o=g.Ay.makeAssetTransferTxnWithSuggestedParamsFromObject({amount:re.amountToDeposit*10**re.feeAssetData.decimals,assetIndex:re.feeAssetId,from:l.addr,suggestedParams:n,to:g.Ay.getApplicationAddress(d)}),i=(0,y.k$)(d,re.appInfo.appId),c=new g.aX;await e.fundTask({deposit:o,taskAppId:re.appInfo.appId},{sendParams:{fee:h.Hv(1e3),atc:c},boxes:[i]});const r=c.buildGroup().map(e=>e.txn);await s.dispatch("signer/returnToSignAll","ScheduledPayments"),await s.dispatch("signer/toSignArray",{txs:r}),await _.push("/signAll")}catch(t){console.error(t)}},Ae=async()=>{try{const t=await s.dispatch("algod/getAlgod"),l={addr:a.params.account,signer:async(e,a)=>[]};var e=new y.Ld({resolveBy:"id",id:re.appInfo.appId,sender:l},t);const d=new g.aX;if(Number(re.withdrawAsset)>0){const a=await s.dispatch("indexer/getAsset",{assetIndex:re.withdrawAsset});await e.assetTransfer({assetAmount:Number(re.withdrawAmount)*10**a.decimals,assetReceiver:l.addr,note:"",xferAsset:Number(re.withdrawAsset)},{sendParams:{fee:h.Hv(2e3),atc:d},assets:[Number(re.withdrawAsset)]})}else await e.payment({amount:Number(re.withdrawAmount)*10**6,receiver:l.addr,note:""},{sendParams:{fee:h.Hv(2e3),atc:d}});await t.getTransactionParams().do();const n=d.buildGroup().map(e=>e.txn);await s.dispatch("signer/returnTo","ScheduledPayments"),await s.dispatch("signer/toSign",{txx:n[0]});const o=(0,m.A)(Buffer.from(g.Ay.encodeUnsignedTransaction(n[0])).toString("base64"));re.txID=n[0].txID(),_.push(`/sign/${a.params.account}/${o}`)}catch(t){console.error(t)}},ye=e=>{_.push({name:"PayToAccountAndAsset",params:{account:a.params.account,toAccountDirect:re.appInfo.appAddress,asset:e["asset-id"]}})};async function ge(e){A()(e)&&await s.dispatch("toast/openSuccess",`${e} copied to clipboard`)}const ve=()=>{_.push({name:"SwapWithTo",params:{account:a.params.account,toAsset:re.feeAssetId}})},be=async()=>{try{const e=await s.dispatch("algod/getAlgod"),a=await e.getApplicationByID(re.appInfo.appId).do(),t=Buffer.from(a.params["global-state"].find(e=>"aWQ="==e.key).value.bytes,"base64").subarray(2).toString("utf-8"),l=await v.A.get(`https://api-scheduler.biatec.io/v1/file/${t}/input.yaml`);re.script=l.data}catch(e){console.error(e)}};return(e,a)=>{const s=(0,t.g2)("InputNumber"),o=(0,t.g2)("InputText"),i=(0,t.g2)("Column"),p=(0,t.g2)("DataTable"),m=(0,t.g2)("InputGroup"),u=(0,t.g2)("Textarea"),h=(0,t.g2)("Card");return(0,t.uX)(),(0,t.Wv)(n.A,null,{default:(0,t.k6)(()=>[(0,t.Lk)("h1",null,(0,l.v_)(e.$t("scheduled_payments.title")),1),(0,t.bF)(h,null,{content:(0,t.k6)(()=>[(0,t.Lk)("p",null,(0,l.v_)(e.$t("scheduled_payments.description_detail")),1),(0,t.Lk)("h2",null,(0,l.v_)(e.$t("scheduled_payments.details_title")),1),(0,t.Lk)("div",b,[(0,t.Lk)("label",w,(0,l.v_)(e.$t("scheduled_payments.app_id")),1),(0,t.Lk)("div",k,(0,l.v_)(re.appInfo.appId),1)]),(0,t.Lk)("div",I,[(0,t.Lk)("label",D,(0,l.v_)(e.$t("scheduled_payments.appAddress")),1),(0,t.Lk)("div",L,(0,l.v_)(re.appInfo.appAddress),1)]),(0,t.Lk)("div",$,[(0,t.Lk)("label",x,(0,l.v_)(e.$t("scheduled_payments.period")),1),(0,t.Lk)("div",F,(0,l.v_)(re.appInfo.period)+" "+(0,l.v_)(e.$t("scheduled_payments.seconds")),1)]),(0,t.Lk)("div",T,[(0,t.Lk)("label",S,(0,l.v_)(e.$t("scheduled_payments.start")),1),(0,t.Lk)("div",R,(0,l.v_)(new Date(1e3*re.appInfo.start)),1)]),(0,t.Lk)("div",V,[(0,t.Lk)("label",P,(0,l.v_)(e.$t("scheduled_payments.feeBalance")),1),(0,t.Lk)("div",C,(0,l.v_)((0,d.R1)(f.A)(re.appInfo.balanceFee,re.feeAssetData["unit-name"]??re.feeAssetData.name,re.feeAssetData.decimals)),1)]),(0,t.Lk)("div",N,[(0,t.Lk)("label",W,(0,l.v_)(e.$t("scheduled_payments.execution_fee")),1),(0,t.Lk)("div",B,(0,l.v_)((0,d.R1)(f.A)(re.appInfo.fee,re.feeAssetData["unit-name"]??re.feeAssetData.name,re.feeAssetData.decimals)),1)]),(0,t.Lk)("h2",null,(0,l.v_)(e.$t("scheduled_payments.deposit_fee_title")),1),(0,t.Lk)("div",U,[(0,t.Lk)("label",X,(0,l.v_)(e.$t("scheduled_payments.fee_asset_id")),1),(0,t.Lk)("div",G,[(0,t.bF)((0,d.R1)(r.A),{size:"small",link:"",onClick:a[0]||(a[0]=e=>ge(re.feeAssetId))},{default:(0,t.k6)(()=>[(0,t.eW)((0,l.v_)(re.feeAssetId),1)]),_:1}),(0,t.bF)((0,d.R1)(r.A),{severity:"secondary",size:"small",onClick:ve},{default:(0,t.k6)(()=>[(0,t.eW)((0,l.v_)(e.$t("scheduled_payments.get_more")),1)]),_:1})])]),(0,t.Lk)("div",j,[(0,t.Lk)("label",E,(0,l.v_)(e.$t("scheduled_payments.amount_to_deposit")),1),(0,t.Lk)("div",H,[(0,t.bF)(s,{itemId:"amountToDeposit",modelValue:re.amountToDeposit,"onUpdate:modelValue":a[1]||(a[1]=e=>re.amountToDeposit=e),min:0,step:1e-6,maxFractionDigits:6,class:"w-full"},null,8,["modelValue"])])]),(0,t.Lk)("div",M,[a[9]||(a[9]=(0,t.Lk)("label",{class:"col-12 mb-2 md:col-2 md:mb-0"},null,-1)),(0,t.Lk)("div",O,[(0,t.bF)((0,d.R1)(r.A),{severity:"primary",onClick:_e},{default:(0,t.k6)(()=>[(0,t.eW)((0,l.v_)(e.$t("scheduled_payments.deposit")),1)]),_:1})])]),(0,t.Lk)("h2",null,(0,l.v_)(e.$t("scheduled_payments.list_of_assets")),1),(0,t.bF)(p,{selection:re.selection,"onUpdate:selection":a[3]||(a[3]=e=>re.selection=e),value:re.assets,"responsive-layout":"scroll","selection-mode":"single",paginator:!0,rows:20,filters:re.filters,"onUpdate:filters":a[4]||(a[4]=e=>re.filters=e),filterDisplay:"menu",globalFilterFields:["asset-id","assetName"]},{header:(0,t.k6)(()=>[re.filters["global"]?((0,t.uX)(),(0,t.CE)("div",Q,[(0,t.Lk)("div",z,[(0,t.Lk)("span",q,[a[10]||(a[10]=(0,t.Lk)("i",{class:"pi pi-search"},null,-1)),(0,t.bF)(o,{modelValue:re.filters["global"].value,"onUpdate:modelValue":a[2]||(a[2]=e=>re.filters["global"].value=e),placeholder:e.$t("placeholders.keyword_search")},null,8,["modelValue","placeholder"])])])])):(0,t.Q3)("",!0)]),empty:(0,t.k6)(()=>[(0,t.eW)((0,l.v_)(e.$t("scheduled_payments.assets_loading")),1)]),default:(0,t.k6)(()=>[(0,t.bF)(i,{field:"assetName",header:e.$t("scheduled_payments.asset_id"),sortable:!0},null,8,["header"]),(0,t.bF)(i,{header:e.$t("scheduled_payments.asset_id"),sortable:!0},{body:(0,t.k6)(e=>[(0,t.eW)((0,l.v_)(e.data["asset-id"]),1)]),_:1},8,["header"]),(0,t.bF)(i,{header:e.$t("scheduled_payments.asset_name"),sortable:!0},{body:(0,t.k6)(e=>[(0,t.eW)((0,l.v_)(e.data.info.name),1)]),_:1},8,["header"]),(0,t.bF)(i,{field:"amount",header:e.$t("scheduled_payments.asset_amount"),sortable:!0},{body:(0,t.k6)(e=>[e.data.amount&&e.data.info?((0,t.uX)(),(0,t.CE)("span",J,(0,l.v_)((0,d.R1)(f.A)(e.data.amount,e.data.info["unit-name"]??e.data.info.name,e.data.info.decimals)),1)):(0,t.Q3)("",!0)]),_:1},8,["header"]),(0,t.bF)(i,{header:e.$t("scheduled_payments.actions"),sortable:!0},{body:(0,t.k6)(a=>[(0,t.bF)((0,d.R1)(r.A),{onClick:e=>ye(a.data)},{default:(0,t.k6)(()=>[(0,t.eW)((0,l.v_)(e.$t("scheduled_payments.deposit")),1)]),_:1},8,["onClick"])]),_:1},8,["header"])]),_:1},8,["selection","value","filters"]),(0,t.Lk)("h2",null,(0,l.v_)(e.$t("scheduled_payments.optin_title")),1),(0,t.Lk)("div",K,[(0,t.Lk)("label",Z,(0,l.v_)(e.$t("scheduled_payments.optin_to_asset")),1),(0,t.Lk)("div",Y,[(0,t.bF)(m,null,{default:(0,t.k6)(()=>[(0,t.bF)(s,{itemId:"optin",modelValue:re.optin,"onUpdate:modelValue":a[5]||(a[5]=e=>re.optin=e),min:0,step:1,class:"w-full"},null,8,["modelValue"]),(0,t.bF)((0,d.R1)(r.A),{severity:"secondary",class:"col-2",onClick:he},{default:(0,t.k6)(()=>[(0,t.eW)((0,l.v_)(e.$t("scheduled_payments.optin_click")),1)]),_:1})]),_:1})])]),(0,t.Lk)("h2",null,(0,l.v_)(e.$t("scheduled_payments.withdraw_asset_title")),1),(0,t.Lk)("div",ee,[(0,t.Lk)("label",ae,(0,l.v_)(e.$t("scheduled_payments.withdraw_asset")),1),(0,t.Lk)("div",se,[(0,t.bF)((0,d.R1)(c.A),{inputId:"withdrawAsset",options:re.assets,modelValue:re.withdrawAsset,"onUpdate:modelValue":a[6]||(a[6]=e=>re.withdrawAsset=e),optionLabel:"assetName",optionValue:"asset-id",class:"w-full"},null,8,["options","modelValue"])])]),(0,t.Lk)("div",te,[(0,t.Lk)("label",le,(0,l.v_)(e.$t("scheduled_payments.withdraw_amount")),1),(0,t.Lk)("div",de,[(0,t.bF)(m,null,{default:(0,t.k6)(()=>[(0,t.bF)(s,{itemId:"withdrawAmount",modelValue:re.withdrawAmount,"onUpdate:modelValue":a[7]||(a[7]=e=>re.withdrawAmount=e),min:0,step:1e-6,maxFractionDigits:6,class:"w-full"},null,8,["modelValue"])]),_:1})])]),(0,t.Lk)("div",ne,[a[11]||(a[11]=(0,t.Lk)("label",{class:"col-12 mb-2 md:col-2 md:mb-0"},null,-1)),(0,t.Lk)("div",oe,[(0,t.bF)((0,d.R1)(r.A),{severity:"secondary",onClick:Ae},{default:(0,t.k6)(()=>[(0,t.eW)((0,l.v_)(e.$t("scheduled_payments.withdraw_click")),1)]),_:1})])]),(0,t.Lk)("h2",null,(0,l.v_)(e.$t("scheduled_payments.load_script_title")),1),(0,t.Lk)("div",ie,[(0,t.bF)((0,d.R1)(r.A),{severity:"secondary",onClick:be},{default:(0,t.k6)(()=>[(0,t.eW)((0,l.v_)(e.$t("scheduled_payments.load_click")),1)]),_:1})]),re.script?((0,t.uX)(),(0,t.CE)("div",ce,[(0,t.bF)(u,{id:"script",modelValue:re.script,"onUpdate:modelValue":a[8]||(a[8]=e=>re.script=e),class:"w-full",rows:"20"},null,8,["modelValue"])])):(0,t.Q3)("",!0)]),_:1})]),_:1})}}});const pe=re;var me=pe}}]);
//# sourceMappingURL=278.ad9f3902.js.map